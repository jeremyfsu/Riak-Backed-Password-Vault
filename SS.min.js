(function(a){function b(a){var b=[];return a.forEach(function(a){b=b.concat(a)}),b}function c(a,b){for(var c=0;c<a.length;c+=1)if(b(a[c],c,a)===!1)return}function d(a,b,c){if(!a.length)return c();var d=0;(function e(){b(a[d],function(b){b||b===!1?(c(b),c=function(){}):(d+=1,d===a.length?c():e())})})()}function g(a,b,c){c=a;for(var d in b)if(b.hasOwnProperty(d)){c=b[d](a);if(c!==a)break}return c===a?"([a-zA-Z0-9-]+)":c}function h(a,b){~a.indexOf("*")&&(a=a.replace(/\*/g,"([_.()!\\ %@&a-zA-Z0-9-]+)"));var c=a.match(/:([^\/]+)/ig),d;if(c){d=c.length;for(var e=0;e<d;e++)a=a.replace(c[e],g(c[e],b))}return a}Array.prototype.filter||(Array.prototype.filter=function(a,b){var c=[],d;for(var e=0,f=this.length;e<f;e++)e in this&&a.call(b,d=this[e],e,this)&&c.push(d);return c}),Array.isArray||(Array.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"});var e=document.location,f={mode:"modern",hash:e.hash,check:function(){var a=e.hash;a!=this.hash&&(this.hash=a,this.onHashChanged())},fire:function(){this.mode==="modern"?window.onhashchange():this.onHashChanged()},init:function(a){function c(){for(var a=0,b=window.Router.listeners.length;a<b;a++)window.Router.listeners[a]()}var b=this;window.Router.listeners||(window.Router.listeners=[]);if("onhashchange"in window&&(document.documentMode===undefined||document.documentMode>7))window.onhashchange=c,this.mode="modern";else{var d=document.createElement("iframe");d.id="state-frame",d.style.display="none",document.body.appendChild(d),this.writeFrame(""),"onpropertychange"in document&&"attachEvent"in document&&document.attachEvent("onpropertychange",function(){event.propertyName==="location"&&b.check()}),window.setInterval(function(){b.check()},50),this.onHashChanged=c,this.mode="legacy"}return window.Router.listeners.push(a),this.mode},destroy:function(a){if(!window.Router||!window.Router.listeners)return;var b=window.Router.listeners;for(var c=b.length-1;c>=0;c--)b[c]===a&&b.splice(c,1)},setHash:function(a){return mode==="legacy"&&this.writeFrame(a),e.hash=a[0]==="/"?a:"/"+a,this},writeFrame:function(a){var b=document.getElementById("state-frame"),c=b.contentDocument||b.contentWindow.document;c.open(),c.write("<script>_hash = '"+a+"'; onload = parent.listener.syncHash;<script>"),c.close()},syncHash:function(){var a=this._hash;return a!=e.hash&&(e.hash=a),this},onHashChanged:function(){}},i=a.Router=function(a){if(this instanceof i)this.params={},this.routes={},this.methods=["on","once","after","before"],this._methods={},this._insert=this.insert,this.insert=this.insertEx,this.configure(),this.mount(a||{});else return new i(a)};i.prototype.configure=function(a){a=a||{};for(var b=0;b<this.methods.length;b++)this._methods[this.methods[b]]=!0;return this.recurse=a.recurse||!1,this.async=a.async||!1,this.delimiter=a.delimiter||"/",this.notfound=a.notfound,this.resource=a.resource,this.every={after:a.after||[],before:a.before||[],on:a.on||[]},this},i.prototype.param=function(a,b){a[0]!==":"&&(a=":"+a);var c=new RegExp(a,"g");this.params[a]=function(a){return a.replace(c,b.source||b)}},i.prototype.on=function(a,b,c){!c&&typeof b=="function"&&(c=b,b=a,a="on"),b.source&&(b=b.source),this.insert(a,b.split(new RegExp(this.delimiter)),c)},i.prototype.dispatch=function(a,c,d){function j(){e.last=f.after,e.invoke(h,e,d)}var e=this,f=this.traverse(a,c,this.routes,""),g=this._invoked,h,i;return this._invoked=!0,!f||f.length===0?(this.last=[],typeof this.notfound=="function"&&this.notfound(d),!1):(this.recurse==="forward"&&(f=f.reverse()),i=[this.every.after].concat(this.last),h=[this.every.before].concat(b(f),this.every.on),h.captures=f.captures,h.source=f.source,i&&i.length>0&&g?(this.async?this.invoke(i,this,j):(this.invoke(i,this),j()),!0):(j(),!0))},i.prototype.invoke=function(a,b,e){var f=this;this.async?d(a,function(c,d){c.apply(b,a.captures.concat(d))},function(){e&&e.apply(null,arguments)}):c(a,function g(d){if(Array.isArray(d))return c(d,g);if(typeof d=="function")return d.apply(b,a.captures||null);typeof d=="string"&&f.resource&&f.resource[d].apply(b,a.captures||null)})},i.prototype.traverse=function(a,b,c,d){var e=[],f,g,h,i;for(var j in c)if(c.hasOwnProperty(j)&&!this._methods[j]){f=d+this.delimiter+j,g=b.match(new RegExp("^"+f));if(!g)continue;if(g[0]&&g[0]==b&&c[j][a])return h=[[c[j].before,c[j][a]].filter(Boolean)],h.after=[c[j].after].filter(Boolean),h.matched=!0,h.captures=g.slice(1),h;h=this.traverse(a,b,c[j],f);if(h.matched)return h.length>0&&(e=e.concat(h)),this.recurse&&(e.push([c[j].before,c[j].on].filter(Boolean)),h.after=h.after.concat([c[j].after].filter(Boolean))),e.matched=!0,e.captures=h.captures,e.after=h.after,e}return!1},i.prototype.insert=function(a,b,c,d){var e=b.shift(),f,g,h,i;d=d||this.routes;if(b.length>0)return d[e]=d[e]||{},this.insert(a,b,c,d[e]);g=typeof d[e],h=Array.isArray(d[e]);if(d[e]&&!h&&g=="object"){f=typeof d[e][a];switch(f){case"function":d[e][a]=[d[e][a],c];return;case"object":d[e][a].push(c);return;case"undefined":d[e][a]=c;return}}else if(g=="undefined"){i={},i[a]=c,d[e]=i;return}throw new Error("Invalid route context: "+g)},i.prototype.insertEx=function(a,b,c,d){return a==="once"&&(a="on",c=function(a){var b=!1;return function(){if(b)return;return b=!0,a.apply(this,arguments)}}(c)),this._insert(a,b,c,d)},i.prototype.extend=function(a){var b=this,c=a.length,d;for(d=0;d<c;d++)(function(a){b[a]=function(c,d){b.on(a,c,d)}})(a[d])},i.prototype.mount=function(a,b){function d(b,d){var e=b,f=b.split(c.delimiter),g=typeof a[b],i=f[0]===""||!c._methods[f[0]],j=i?"on":e;i&&(e=e.slice(c.delimiter.length),f.shift());if(i&&g==="object"&&!Array.isArray(a[b])){for(var k=0;k<f.length;k++)/\:|\*/.test(f[k])&&(f[k]=h(f[k],c.params));d=d.concat(f),c.mount(a[b],d);return}/\:|\*/.test(e)&&(e=h(e,c.params)),i&&(d=d.concat(e.split(c.delimiter))),c.insert(j,d,a[b])}if(!a||typeof a!="object"||Array.isArray(a))return;var c=this;b=b||[];for(var e in a)a.hasOwnProperty(e)&&d(e,b.slice(0))},i.prototype.init=function(a){var b=this;return this.handler=function(){var a=e.hash.replace(/^#/,"");b.dispatch("on",a)},e.hash===""&&a&&(e.hash=a),e.hash.length>0&&this.handler(),f.init(this.handler),this},i.prototype.explode=function(){var a=e.hash;return a[1]==="/"&&(a=a.slice(1)),a.slice(1,a.length).split("/")},i.prototype.setRoute=function(a,b,c){var d=this.explode();return typeof a=="number"&&typeof b=="string"?d[a]=b:typeof c=="string"?d.splice(a,b,s):d=[a],f.setHash(d.join("/")),d},i.prototype.getState=function(){return this.state},i.prototype.getRoute=function(a){var b=a;if(typeof a=="number")b=this.explode()[a];else if(typeof a=="string"){var c=this.explode();b=c.indexOf(a)}else b=this.explode();return b},i.prototype.destroy=function(){return f.destroy(this.handler),this},i.prototype.recurse=function(a){if(a===undefined)return recurse;this.add=(this._recurse=a)==="forward"?"unshift":"push"}})(window)