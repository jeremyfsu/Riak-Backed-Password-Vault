<html>
    <head>
        <script src="/riak/vault/jquery.js"></script>
        <script src="/riak/vault/json2.js"></script>
        <script src="/riak/vault/riak.js"></script>
    </head>
    <body>
        <form id="search" action="index.html">
            Key: <input type="text" id="key" /><br />
            Value: <input type="text" id="value" /><br/>
            <input type="submit" value="Find" />
            <input type="button" value="Save" onclick="save();"/>
        </form>
        <div id="result">

        </div>
    </body>
    <script>
        $('#search').submit(function() {
            client = new RiakClient();
            bucket = client.bucket('vault', function(b){get_bucket(b);});
            return false;
        });

        function save(){
            client = new RiakClient();
            client.bucket('vault', function(b){save_bucket(b);});
            $('#result').text($('input#value').val() + ' saved');
        }

        function save_bucket(b){
            b.get_or_new($('input#key').val(), function(status, o){save_object(o);});
        }

        function save_object(o){
            o.body = $('input#value').val();
            o.contentType = 'text/plain';
            o.store();
        }

        function get_bucket(b){
            object = b.get($('input#key').val(), function(s,o){get_object(o);});
        }

        function get_object(o){
            $('input#value').val(o.body);
        }
    </script>
</html>